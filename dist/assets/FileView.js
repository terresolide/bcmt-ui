import{z as C,u as F,r as O,o as k,w as B,k as w,c as n,e as s,p as v,f as E,g as U,q as y,F as u,s as d,y as L,d as a,t as c,m as N}from"./index.js";import{_}from"./FileComponent.js";const z={style:{background:"rgba(0,0,0,0.2)",margin:"0",padding:"10px"}},I={class:"station-page"},M=["value"],R=["value"],j=["value"],A=["value"],G={__name:"FileView",setup(H){const i=F().state.api,g=w(),m=L(),t=O({id:null,group:null,feature:null,files:[],sensor:"",sensors:[],dataType:"",dataTypes:{},observedProperty:"",observedProperties:[],frequency:"",frequencies:[]});function T(){m.push({name:"map"})}function b(){q(),x(),P(),$()}function q(){var r=i+"/Sensors?$expand=Datastreams($top=1;$expand=Thing($filter=id eq "+t.id+"))",r=i+"/Sensors?$filter=Datastreams/@iot.id gt 0";fetch(r).then(e=>e.ok?e.json():{error:e.status+" - "+e.statusText}).then(e=>{console.log(e),e.value&&(console.log(e.value),t.sensors=e.value,console.log(t.sensors[0]))})}function P(){var r=i+"/Datastreams?$select=distinct:properties/samplingPeriod";fetch(r).then(e=>e.json(),e=>e).then(e=>{e.value.forEach(function(o){console.log(e),t.frequencies.push(o.properties.samplingPeriod)})})}function $(){var r=i+"/ObservedProperties?$expand=Datastreams($top=1;$expand=Thing($filter=id eq "+t.id+"))",r=i+"/ObservedProperties?$filter=Datastreams/@iot.id gt 0";fetch(r).then(e=>e.ok?e.json():{error:e.status+" - "+e.statusText}).then(e=>{if(e.value){var o=e.value,p=["variation","quasidefinitive","definitive"];t.dataTypes={},o.forEach(function(f){for(var V in p){var l=p[V];if(f.name.indexOf(l)>=0){t.dataTypes[l]||(t.dataTypes[l]={value:l,name:l,list:[]}),f.frequency=f.name.replace(l,""),t.dataTypes[l].list.push(f);break}}}),console.log(t.dataTypes)}})}function x(){var r=i+"/Datastreams?$top=30&$expand=Sensor,Thing/Locations&$orderBy=name desc";fetch(r).then(e=>e.ok?e.json():{error:e.status+" - "+e.statusText}).then(e=>{e.value&&(t.files=e.value)})}function h(){var r=Object.assign({},g.query.op);if(!t.dataType)t.observedProperty="",console.log("pas de dataType"),r.op&&delete r.op;else if(t.observedProperty){var e=t.dataTypes[t.dataType].list.find(o=>o.frequency===t.observedProperty);!e&&r.op?(t.observedProperty="",delete r.op):r.op=e["@iot.id"]}else r.op=t.dataTypes[t.dataType].list.map(o=>o["@iot.id"]).join(",")}function S(){console.log(t.frequency)}function D(r){var e=Object.assign({},g.query.op);if(t.observedProperty){var o=t.dataTypes[t.dataType].list.find(p=>p.frequency===t.observedProperty);e.op=o["@iot.id"]}else!o&&e.op&&(t.observedProperty="",delete e.op);console.log(e)}return k(()=>{b()}),B(g.query,()=>{console.log("getFiles")}),(r,e)=>(a(),n("div",z,[s("div",I,[s("h3",{class:"bcmtObservatory"},[e[4]||(e[4]=U("FILES ")),s("span",{class:"back",onClick:T}," Ã— ")]),e[9]||(e[9]=s("label",null,"DataType",-1)),v(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.dataType=o),onChange:h},[e[5]||(e[5]=s("option",{value:""},"---",-1)),(a(!0),n(u,null,d(t.dataTypes,o=>(a(),n("option",{value:o.value},c(o.name),9,M))),256))],544),[[y,t.dataType]]),t.dataType?v((a(),n("select",{key:0,"onUpdate:modelValue":e[1]||(e[1]=o=>t.observedProperty=o),onChange:D},[e[6]||(e[6]=s("option",{value:""},"---",-1)),(a(!0),n(u,null,d(t.dataTypes[t.dataType].list,o=>(a(),n("option",{value:o.frequency},c(o.frequency),9,R))),256))],544)),[[y,t.observedProperty]]):E("",!0),e[10]||(e[10]=s("label",null,"Sampling period",-1)),v(s("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.frequency=o),onChange:S},[e[7]||(e[7]=s("option",{value:""},"---",-1)),(a(!0),n(u,null,d(t.frequencies,o=>(a(),n("option",{value:o},c(o),9,j))),256))],544),[[y,t.frequency]]),e[11]||(e[11]=s("label",null,"Sensor",-1)),v(s("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.sensor=o)},[e[8]||(e[8]=s("option",{value:""},"---",-1)),(a(!0),n(u,null,d(t.sensors,o=>(a(),n("option",{value:o["@iot.id"]},c(o.name),9,A))),256))],512),[[y,t.sensor]]),(a(!0),n(u,null,d(t.files,o=>(a(),N(_,{file:o,group:t.group},null,8,["file","group"]))),256))])]))}},W=C(G,[["__scopeId","data-v-37734c7d"]]);export{W as default};
